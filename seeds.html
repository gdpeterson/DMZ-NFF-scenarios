<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Seeds • DMZ Futures Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{ --ink:#0f172a; --muted:#64748b; --card:#f8fafc; --stroke:#cbd5e1; --axis:#475569;
           --chip-bg:#ffffff; --chip-stroke:#e2e8f0; --shadow:0 10px 25px rgba(15,23,42,.08); }
    body{ font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple SD Gothic Neo,Malgun Gothic,sans-serif;
          max-width:1060px; margin:2rem auto; padding:0 1rem; color:var(--ink);
          background: radial-gradient(1200px 600px at 30% -10%, #eef2ff 0%, #ffffff 55%); }
    header{ display:flex; justify-content:space-between; align-items:center; gap:1rem; flex-wrap:wrap; }
    nav a{ color:var(--muted); text-decoration:none; margin-right:1rem; }
    .toolbar{ display:flex; gap:.75rem; align-items:center; margin:.5rem 0 1rem; }
    select{ padding:.4rem .6rem; border-radius:8px; border:1px solid var(--stroke); background:#fff; }
    .grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:1rem; }
    .card{ padding:1rem; border:1px solid var(--stroke); border-radius:14px; background:var(--card); box-shadow:var(--shadow); }
    .muted{ color:var(--muted); font-size:.92rem; }
    button.toggle{ padding:.35rem .7rem; border-radius:8px; border:1px solid var(--stroke); background:#fff; cursor:pointer; }
    button.toggle.active{ background:#0f172a; color:#fff; border-color:#0f172a; }
    pre.err{ white-space:pre-wrap; color:#e11d48; background:#fff3f3; border:1px solid #fca5a5; border-radius:8px; padding:.75rem; }
  </style>
  <script>
    const STATIC_I18N = {
      en:{ title:"Seeds • DMZ Futures Explorer", h1:"Seeds Library", filter:"Filter by domain", all:"All domains",
           back:"← Back to Explore", source:"Source" },
      kr:{ title:"시드 • DMZ 미래 탐색기", h1:"시드 라이브러리", filter:"도메인으로 필터", all:"모든 도메인",
           back:"← 탐색으로 돌아가기", source:"출처" }
    };
    function applyI18n(lang){
      document.title = STATIC_I18N[lang].title;
      document.getElementById("h1").textContent = STATIC_I18N[lang].h1;
      document.getElementById("label-filter").textContent = STATIC_I18N[lang].filter;
      document.getElementById("back").textContent = STATIC_I18N[lang].back;
      const sel = document.getElementById("domain");
      if (sel && sel.options.length) sel.options[0].text = STATIC_I18N[lang].all;
      document.querySelectorAll("[data-source-label]").forEach(el => el.textContent = STATIC_I18N[lang].source + ": ");
    }
    document.addEventListener("dmz-lang-change", e => applyI18n(e.detail.lang));
  </script>
</head>
<body>
  <header>
    <h1 id="h1">Seeds Library</h1>
    <div>
      <button id="btn-en" class="toggle">EN</button>
      <button id="btn-kr" class="toggle">KR</button>
    </div>
  </header>
  <nav>
    <a id="back" href="index.html">← Back to Explore</a>
  </nav>

  <div class="toolbar">
    <label id="label-filter" for="domain">Filter by domain</label>
    <select id="domain">
      <option value="">All domains</option>
    </select>
  </div>

  <div id="grid" class="grid"></div>

  <script>
    // ---- Language wiring ----
    let LANG = localStorage.getItem("dmz-lang") || "en";
    function setLang(lang){
      LANG = lang; localStorage.setItem("dmz-lang",lang);
      document.getElementById("btn-en").classList.toggle("active", lang==="en");
      document.getElementById("btn-kr").classList.toggle("active", lang==="kr");
      applyI18n(lang);
      document.dispatchEvent(new CustomEvent("dmz-lang-change",{detail:{lang}}));
      render();
    }
    document.getElementById("btn-en").addEventListener("click", ()=>setLang("en"));
    document.getElementById("btn-kr").addEventListener("click", ()=>setLang("kr"));
    applyI18n(LANG);
    document.getElementById("btn-en").classList.toggle("active", LANG==="en");
    document.getElementById("btn-kr").classList.toggle("active", LANG==="kr");

    // ---- Data load with diagnostics ----
    let seeds = [];
    const domainSel = document.getElementById("domain");
    domainSel.addEventListener("change", render);

    const url = "./data/seeds.json"; // <- explicit relative path
    fetch(url, { cache: "no-store" })
      .then(async r => {
        const text = await r.text();
        if (!r.ok) {
          throw new Error(`HTTP ${r.status} for ${r.url}\n\nFirst 200 chars:\n${text.slice(0,200)}`);
        }
        // If server returned HTML (e.g., 404 page), show that
        if (/^\s*</.test(text)) {
          throw new Error(`Expected JSON but got HTML from ${r.url}\n\nFirst 200 chars:\n${text.slice(0,200)}`);
        }
        try {
          seeds = JSON.parse(text);
        } catch (e) {
          throw new Error(`JSON parse error: ${e.message}\n\nFirst 200 chars:\n${text.slice(0,200)}`);
        }
        if (!Array.isArray(seeds)) throw new Error("Parsed seeds.json is not an array.");

        // Populate domains
        const domains = [...new Set(seeds.map(s=>s.domain).filter(Boolean))].sort();
        for (const d of domains) {
          const opt = document.createElement("option");
          opt.value = d; opt.textContent = d;
          domainSel.appendChild(opt);
        }
        render();
      })
      .catch(err => {
        document.getElementById("grid").innerHTML =
          `<pre class="err">Load error:\n${err.message}</pre>`;
        console.error("[seeds] load error", err);
      });

    // ---- Render ----
    function render(){
      const grid = document.getElementById("grid");
      const dom = domainSel.value;
      const list = dom ? seeds.filter(s=>s.domain===dom) : seeds;
      grid.innerHTML = list.map(s=>`
        <article class="card">
          <h3>${LANG==="kr" ? (s.title_kr||"") : (s.title_en||"")}</h3>
          <p class="muted">${LANG==="kr" ? (s.description_kr||"") : (s.description_en||"")}</p>
          <p class="muted"><strong data-source-label>Source: </strong>${s.source||"—"}</p>
        </article>
      `).join("");
    }
  </script>
</body>
</html>
